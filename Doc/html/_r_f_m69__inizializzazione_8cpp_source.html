<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RFM69:  File sorgente /Users/noe/Personale/Informatica/Arduino/Quadricottero/Versione 3/Quadcopter/libraries/RFM69/src/RFM69_inizializzazione.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RFM69
   </div>
   <div id="projectbrief">Driver per i moduli radio RFM69</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generato da Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Cerca');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">RFM69_inizializzazione.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_r_f_m69__inizializzazione_8cpp.html">Vai alla documentazione di questo file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_r_f_m69_8h.html">RFM69.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_r_f_m69__registri_8h.html">RFM69_registri.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_r_f_m69__impostazioni_8h.html">RFM69_impostazioni.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// ### 1. Completamento delle impostazioni ### //</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// In questa sezione vengono definite le costanti che rappresentano le impostazioni</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// della radio non modaificabili perché richieste dalla classe oppure rese inutili</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// dalla stessa, e che perciò non fanno parte del file di impostazione.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// [0x2] Data processing mode</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// _PACKET, _CONTINUOUS_SYNC, _CONTINUOUS_NO_SYNC</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#define DATA_MODE                       DATA_MODE_PACKET</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// [0x37] Defines the packet format used</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// _FIXED, _VARIABLE</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#define PACKET_FORMAT                   PACKET_FORMAT_VARIABLE</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// [0x38] Packet-&gt;fixed: payload length; -&gt;variable: max length in Rx, not used in Tx.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// x ; max per la radio: 255 se AES è OFF, 64 se AES è ON</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// MAX PER LA LIBRERIA: 64</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#define PAYLOAD_LENGHT                  64</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// [0x2E] FIFO filling condition</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// _SYNC_ADDR, _ALWAYS</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#define FIFO_FILL_COND                  FIFO_FILL_COND_SYNC_ADDR</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// [0x37] Defines address based filtering in Rx</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// _NONE, _NO_BROAD, _BROADCAST</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#define ADDRESS_FILTERING               ADDRESS_FILTERING_NONE</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">// [0x39] Node address used in address filtering</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// x</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#define NODE_ADDRESS                    0x0</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// [0x3A] Broadcast address used in address filtering</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// x</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#define BROADCAST_ADDRESS               0x0</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// [0x3B] Auto modes: intermediate mode</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// _SLEEP, _STANDBY, _RX, _TX</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#define AUTO_MODES_MODE                 AUTO_MODES_MODE_SLEEP</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// [0x3B] Interrupt condition for entering the intermediate mode</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// _NONE_ FIFO_NOT_EMPTY_RISING, _FIFO_LEVEL_RISING, _CRC_OK_RISING, _PAYLOAD_READY_RISING</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//_SYNC_ADDRESS_RISING, _PACKET_SENT_RISING, _FIFO_NOT_EMPTY_FALLING</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#define AUTO_MODES_ENTER                AUTO_MODES_ENTER_NONE</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">// [0x3B] Interrupt condition for exiting the intermediate mode (TMT -&gt; timeout)</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// _NONE, _FIFO_NOT_EMPTY_FALLING, _FIFO_LEVEL_RISING_OR_TMT, _CRC_OK_RISING_OR_TMT</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// _PAYLOAD_READY_RISING_OR_TMT, _SYNC_ADDRESS_RISING_OR_TMT, _PACKET_SENT_RISING</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// _FIFO_NOT_EMPTY_RISING</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#define AUTO_MODES_EXIT                 AUTO_MODES_EXIT_NONE</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">// [0x3C] Defines the condition to start packet transmission</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">// _FIFO_LEVEL FIFO_NOT_EMPTY</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#define TX_START_COND                   TX_START_COND_FIFO_NOT_EMPTY</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">// [0x3C] Used to trigger FifoLevel interrupt</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">// x == nuber of bytes in FIFO</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#define FIFO_TRESH                      0xf</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// [0x2A] Timeout interrupt is generated TIMEOUT_RX_START*16*Tbit after switching to Rx</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">// mode if Rssi interrupt doesn’t occur.         x, OFF: interrupt is disabled</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#define TIMEOUT_RX_START                OFF</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// [0x2B] Timeout interrupt is generated TIMEOUT_RSSI_TRESH*16*Tbit after Rssi interrupt</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// if PayloadReady interrupt doesn’t occur.     x, OFF: interrupt is disabled</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#define TIMEOUT_RSSI_TRESH              OFF</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">// [0x3D] Enables automatic RX restart after PayloadReady and FIFO empty</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">// ON OFF</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#define AUTO_RX_RESTART_EN              OFF</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// ### 2. Interpretazione dei dati del file di impostazione ### //</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">// (Le costanti create in quel file sono usate esclusivamente in questa sezione)</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// # Preimpostazioni #</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">// array usate nella creazione di `registri`</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">// devono essere constexpr (non const) perché sono usate per inizializzare un&#39;array</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">// salvata nella memoria del programma</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keyword">static</span> constexpr uint8_t sync_val [8] = {SYNC_VAL};</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#if AES_EN == ON</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span> constexpr uint8_t aes_key [16] = {AES_KEY};</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">//Macro per l&#39;accesso all&#39;array valoreRegistri</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#define VALORE_REGISTRI(i) pgm_read_byte_near(valoreRegistri + i)</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">// # Creazione dell&#39;array di impostazione #</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> PROGMEM uint8_t valoreRegistri[80] = {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    0,                                                          <span class="comment">// 00 | RFM69_00_FIFO</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    0x4,                                                        <span class="comment">// 01 | RFM69_01_OP_MODE</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    (DATA_MODE &lt;&lt; 5) | (MODULATION &lt;&lt; 3) | (SHAPING),           <span class="comment">// 02 | RFM69_02_DATA_MODUL</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    (uint8_t)(BIT_RATE_VAL(BIT_RATE) &gt;&gt; 8),                     <span class="comment">// 03 | RFM69_03_BITRATE_MSB</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    (uint8_t)BIT_RATE_VAL(BIT_RATE),                            <span class="comment">// 04 | RFM69_04_BITRATE_LSB</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    (uint8_t)(FREQ_DEV_VAL(FREQ_DEV) &gt;&gt; 8),                     <span class="comment">// 05 | RFM69_05_FDEV_MSB</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    (uint8_t)FREQ_DEV_VAL(FREQ_DEV),                            <span class="comment">// 06 | RFM69_06_FDEF_LSB</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    (uint8_t)(RADIO_FREQ_VAL(RADIO_FREQ) &gt;&gt; 16),                <span class="comment">// 07 | RFM69_07_FRF_MSB</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    (uint8_t)(RADIO_FREQ_VAL(RADIO_FREQ) &gt;&gt; 8),                 <span class="comment">// 08 | RFM69_08_FRF_MID</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    (uint8_t)RADIO_FREQ_VAL(RADIO_FREQ),                        <span class="comment">// 09 | RFM69_09_FRF_LSB</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    0,                                                          <span class="comment">// 10 | RFM69_0A_OSC_1</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    (AFC_LOW_BETA_EN &lt;&lt; 5),                                     <span class="comment">// 11 | RFM69_0B_AFC_CTRL</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">//[...]</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    (LISTEN_RESOL_IDLE &lt;&lt; 6) | (LISTEN_RESOL_RX &lt;&lt; 4) | (LISTEN_CRIT &lt;&lt; 3) | (LISTEN_END &lt;&lt; 1),<span class="comment">// 12 | RFM69_0D_LISTEN_1</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    LISTEN_COEF_IDLE,                                           <span class="comment">// 13 | RFM69_0E_LISTEN_2</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    LISTEN_COEF_RX,                                             <span class="comment">// 14 | RFM69_0F_LISTEN_3</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    0,                                                          <span class="comment">// 15 | RFM69_10_VERSION</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    (uint8_t)POWER_VAL(POTENZA_TX),                             <span class="comment">// 16 | RFM69_11_PA_LEVEL</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    PA_RAMP,                                                    <span class="comment">// 17 | RFM69_12_PA_RAMP</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    (OCP_EN &lt;&lt; 4) | (OCP_TRIM_VAL(OCP_TRIM)),                   <span class="comment">// 18 | RFM69_13_OCP</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">//[...]</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    (LNA_IMPEND &lt;&lt; 7) | (LNA_GAIN),                             <span class="comment">// 19 | RFM69_18_LNA</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    (DCC_FREQ &lt;&lt; 5) | RX_BW_VAL(RX_BW, MODULATION),             <span class="comment">// 20 | RFM69_19_RX_BW</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    (DCC_FREQ_AFC &lt;&lt; 5) | RX_BW_VAL(RX_BW_AFC, MODULATION),     <span class="comment">// 21 | RFM69_1A_AFC_BW</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    (OOK_TRESH_TYPE &lt;&lt; 6) | (OOK_PEAK_TRESH_STEP &lt;&lt; 3) | (OOK_PEAK_TRESH_DEC),<span class="comment">// 22 | RFM69_1B_OOK_PEAK</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    (OOK_AVRG_TRESH_FILT &lt;&lt; 6),                                 <span class="comment">// 23 | RFM69_1C_OOK_AVG</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    OOK_FIXED_TRESH,                                            <span class="comment">// 24 | RFM69_1D_OOK_FIX</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    (AFC_AUTOCLEAR &lt;&lt; 3) | (AFC_AUTO &lt;&lt; 2),                     <span class="comment">// 25 | RFM69_1E_AFC_FEI</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    0,                                                          <span class="comment">// 26 | RFM69_1F_AFC_MSB</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    0,                                                          <span class="comment">// 27 | RFM69_20_AFC_LSB</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    0,                                                          <span class="comment">// 28 | RFM69_21_FEI_MSB</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    0,                                                          <span class="comment">// 29 | RFM69_22_FEI_LSB</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    0,                                                          <span class="comment">// 30 | RFM69_23_RSSI_CONFIG</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    0,                                                          <span class="comment">// 31 | RFM69_24_RSSI_VALUE</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    0,                                                          <span class="comment">// 32 | RFM69_25_DIO_MAPPING_1</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    0x7,                                                        <span class="comment">// 33 | RFM69_26_DIO_MAPPING_2</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    0,                                                          <span class="comment">// 34 | RFM69_27_IRQ_FLAGS_1</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    0,                                                          <span class="comment">// 35 | RFM69_28_IRQ_FLAGS_2</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    (uint8_t)RSSI_TRESH_VAL(RSSI_TRESH),                        <span class="comment">// 36 | RFM69_29_RSSI_TRESH</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    TIMEOUT_RX_START,                                           <span class="comment">// 37 | RFM69_2A_RX_TIMEOUT_1</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    TIMEOUT_RSSI_TRESH,                                         <span class="comment">// 38 | RFM69_2B_RX_TIMEOUT_2</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    (uint8_t)(PREAMBLE_SIZE &gt;&gt; 8),                              <span class="comment">// 39 | RFM69_2C_PREAMBLE_MSB</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    (uint8_t) PREAMBLE_SIZE,                                    <span class="comment">// 40 | RFM69_2D_PREAMBLE_LSB</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    (SYNC_EN &lt;&lt; 7) | (FIFO_FILL_COND &lt;&lt; 6) | (SYNC_SIZE_VAL(SYNC_SIZE) &lt;&lt; 3) | SYNC_TOL,<span class="comment">// 41 | RFM69_2E_SYNC_CONFIG</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    sync_val[0],                                                <span class="comment">// 42 | RFM69_2F_SYNC_VALUE_1</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    sync_val[1],                                                <span class="comment">// 43 | RFM69_30_SYNC_VALUE_2</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    sync_val[2],                                                <span class="comment">// 44 | RFM69_31_SYNC_VALUE_3</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    sync_val[3],                                                <span class="comment">// 45 | RFM69_32_SYNC_VALUE_4</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    sync_val[4],                                                <span class="comment">// 46 | RFM69_33_SYNC_VALUE_5</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    sync_val[5],                                                <span class="comment">// 47 | RFM69_34_SYNC_VALUE_6</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    sync_val[6],                                                <span class="comment">// 48 | RFM69_35_SYNC_VALUE_7</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    sync_val[7],                                                <span class="comment">// 49 | RFM69_36_SYNC_VALUE_8</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    (PACKET_FORMAT &lt;&lt; 7) | (ENCODING &lt;&lt; 5) | (CRC_EN &lt;&lt; 4) | (PAYLOAD_READY_ON_CRC_FAIL &lt;&lt; 3) | (ADDRESS_FILTERING &lt;&lt; 1),<span class="comment">// 50 | RFM69_37_PACKET_CONFIG_1</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    PAYLOAD_LENGHT,                                              <span class="comment">// 51 | RFM69_38_PAYLOAD_LENGHT</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    NODE_ADDRESS,                                                <span class="comment">// 52 | RFM69_39_NODE_ADRS</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    BROADCAST_ADDRESS,                                           <span class="comment">// 53 | RFM69_3A_BROADCAST_ADRS</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    (AUTO_MODES_ENTER &lt;&lt; 5) | (AUTO_MODES_EXIT &lt;&lt; 2) | AUTO_MODES_MODE,<span class="comment">// 54 | RFM69_3B_AUTO_MODES</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    (TX_START_COND &lt;&lt; 7) | FIFO_TRESH,                           <span class="comment">// 55 | RFM69_3C_FIFO_TRESH</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    (INTER_PACKET_RX_DELAY &lt;&lt; 4) | (AUTO_RX_RESTART_EN &lt;&lt; 1) | AES_EN,<span class="comment">// 56 | RFM69_3D_PACKET_CONFIG_2</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    #<span class="keywordflow">if</span> AES_EN == ON</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    aes_key[0],                                                  <span class="comment">// 57 | RFM69_3E_AES_KEY_1</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    aes_key[1],                                                  <span class="comment">// 58 | RFM69_3F_AES_KEY_2</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    aes_key[2],                                                  <span class="comment">// 59 | RFM69_40_AES_KEY_3</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    aes_key[3],                                                  <span class="comment">// 60 | RFM69_41_AES_KEY_4</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    aes_key[4],                                                  <span class="comment">// 61 | RFM69_42_AES_KEY_5</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    aes_key[5],                                                  <span class="comment">// 62 | RFM69_43_AES_KEY_6</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    aes_key[6],                                                  <span class="comment">// 63 | RFM69_44_AES_KEY_7</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    aes_key[7],                                                  <span class="comment">// 64 | RFM69_45_AES_KEY_8</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    aes_key[8],                                                  <span class="comment">// 65 | RFM69_46_AES_KEY_9</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    aes_key[9],                                                  <span class="comment">// 66 | RFM69_47_AES_KEY_10</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    aes_key[10],                                                 <span class="comment">// 67 | RFM69_48_AES_KEY_11</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    aes_key[11],                                                 <span class="comment">// 68 | RFM69_49_AES_KEY_12</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    aes_key[12],                                                 <span class="comment">// 69 | RFM69_4A_AES_KEY_13</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    aes_key[13],                                                 <span class="comment">// 70 | RFM69_4B_AES_KEY_14</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    aes_key[14],                                                 <span class="comment">// 71 | RFM69_4C_AES_KEY_15</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    aes_key[15],                                                 <span class="comment">// 72 | RFM69_4D_AES_KEY_16</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    #<span class="keywordflow">else</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    0,                                                           <span class="comment">// 57 | RFM69_3E_AES_KEY_1</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    0,                                                           <span class="comment">// 58 | RFM69_3F_AES_KEY_2</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    0,                                                           <span class="comment">// 59 | RFM69_40_AES_KEY_3</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    0,                                                           <span class="comment">// 60 | RFM69_41_AES_KEY_4</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    0,                                                           <span class="comment">// 61 | RFM69_42_AES_KEY_5</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    0,                                                           <span class="comment">// 62 | RFM69_43_AES_KEY_6</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    0,                                                           <span class="comment">// 63 | RFM69_44_AES_KEY_7</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    0,                                                           <span class="comment">// 64 | RFM69_45_AES_KEY_8</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    0,                                                           <span class="comment">// 65 | RFM69_46_AES_KEY_9</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    0,                                                           <span class="comment">// 66 | RFM69_47_AES_KEY_10</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    0,                                                           <span class="comment">// 67 | RFM69_48_AES_KEY_11</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    0,                                                           <span class="comment">// 68 | RFM69_49_AES_KEY_12</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    0,                                                           <span class="comment">// 69 | RFM69_4A_AES_KEY_13</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    0,                                                           <span class="comment">// 70 | RFM69_4B_AES_KEY_14</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    0,                                                           <span class="comment">// 71 | RFM69_4C_AES_KEY_15</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    0,                                                           <span class="comment">// 72 | RFM69_4D_AES_KEY_16</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    #endif</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    0,                                                           <span class="comment">// 73 | RFM69_4E_TEMP_1</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    0,                                                           <span class="comment">// 74 | RFM69_4F_TEMP_2</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">//[...]</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    SENSIVITY_MODE,                                              <span class="comment">// 75 | RFM69_58_TEST_LNA</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">//[...]</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    0x55,                                                        <span class="comment">// 76 | RFM69_5A_TEST_PA_1</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">//[...]</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    0x70,                                                        <span class="comment">// 77 | RFM69_5C_TEST_PA_2</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">//[...]</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    CONTINUOUS_DAGC,                                             <span class="comment">// 78 | RFM69_6F_TEST_DAGC</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">//[...]</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    LOW_BETA_AFC_OFFSET                                          <span class="comment">// 79 | RFM69_71_TEST_AFC</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;};</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">// Esecuzione di una macro per la definizione dell&#39;unica impostazione del file</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">// di impostazione della radio che non va nei registri ma serve alla classe</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="preprocessor">#define HIGH_POWER      IS_HIGH_POWER(POTENZA_TX)</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">// ### da qui in poi saranno usate solo le costanti etichettate come [software] nel</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">// file di impostazione ###</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">// ### 3. Definizione dei membri static ### //</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">// Definizione dei membri `static`di questa classe</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;uint8_t RFM69::nrIstanze = 0;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<a class="code" href="class_r_f_m69.html">RFM69</a>* RFM69::pointerRadio = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">// ### 4. Constructor e destructor ### //</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#adfa7e0b65159b8a2e31c2b687c3f7181">  242</a></span>&#160;<a class="code" href="class_r_f_m69.html#adfa7e0b65159b8a2e31c2b687c3f7181">RFM69::RFM69</a>(<a class="code" href="class_r_f_m69_1_1_bus.html">RFM69::Bus</a>* interfaccia, uint8_t pinInterrupt, uint8_t pinReset) :</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;pinReset(pinReset),</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;numeroInterrupt(digitalPinToInterrupt(pinInterrupt)),</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;haReset(pinReset == 0xff ? false : true),</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;highPower(HIGH_POWER), <span class="comment">// highPower non è constante</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;bus(interfaccia)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;{</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    nrIstanze++;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a82f0292b4968b3d497587341f513fb15">  253</a></span>&#160;<a class="code" href="class_r_f_m69_1_1_bus.html">RFM69::Bus</a>* <a class="code" href="class_r_f_m69.html#a82f0292b4968b3d497587341f513fb15">RFM69::creaInterfacciaSpi</a>(uint8_t pinSS) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Impostazioni SPI: bit order e data mode, MSB first e cpol0cpha0</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// rispettivamente, sono richiesti dalla radio, mentre la velocità è</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// arbitraria. Attenzione però a cambiare la velocità (ora 200&#39;000): un test</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// a 4&#39;000&#39;000 sembra aver generato un errore segnalato da avrdude con</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// &quot;content mismatch: 0x45 != 0x0c at 0x0000&quot;, che si è risolto solo dopo la</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// reinstallazione del bootloader.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_r_f_m69_1_1_spi.html">Spi</a>(pinSS, 200000, Spi::BitOrder::MSBFirst, Spi::DataMode::cpol0cpha0);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a071ccf60c7bee588fef852027db4e734">  264</a></span>&#160;<a class="code" href="class_r_f_m69_1_1_bus.html">RFM69::Bus</a>* <a class="code" href="class_r_f_m69.html#a071ccf60c7bee588fef852027db4e734">RFM69::creaInterfacciaSC18IS602B</a>(uint8_t indirizzoSC18, uint8_t numeroSS) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_r_f_m69_1_1_s_c18_i_s602_b.html">SC18IS602B</a>(indirizzoSC18, numeroSS);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">// Destructor</span></div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a1480e160ba613aa6eacc372b87973cbd">  270</a></span>&#160;<a class="code" href="class_r_f_m69.html#a1480e160ba613aa6eacc372b87973cbd">RFM69::~RFM69</a>() {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// il buffer è in una classe wrapper che si occupa di liberare la memoria</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keyword">delete</span> bus;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    nrIstanze--;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">// ### 5. Inizializzazione ### //</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">// Inizializzazione della radio</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">// Cerca di inizializzare la radio e restituisce ErroreInit::ok (-&gt; 0) se ci riesce</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#ad3f48e5290ae7a04fcb82c79386eff68">  287</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_r_f_m69.html#ad3f48e5290ae7a04fcb82c79386eff68">RFM69::inizializza</a>(uint8_t lunghezzaMaxMessaggio) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// Questa versione della classe ha un&#39;unica ISR, dichiarata come static,</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// quindi in un programma ne può esistere una sola instanza.</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// Per aggiungerne altre bisogna aggiungere una o più altre funzioni isrCaller()</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// (static void isrCaller1(); static void isrCaller2(); ...  ) e collegare</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// ad ognuna di esse un&#39;istanza differente (pointerRadio non sarà più uno solo</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// ma uno per ogni isrCaller, e tutti diversi fra loro)</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span>(nrIstanze &gt; 1) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdab9cfc9dd42ee81347cf9fd0e4aa6954a">Errore::initTroppeRadio</a>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// ## SPI ## //</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// Inizializzazione di SPI</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span>(!bus-&gt;inizializza()) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdad236e6412b9f36d8fcac011626cd78a7">Errore::initInitSPIFallita</a>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// ## RESET ## //</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// Il pin RESET della radio può facoltativamente essere collegato al microcontrollore</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span>(haReset) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        pinMode(pinReset, OUTPUT);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        digitalWrite(pinReset, HIGH);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        delay(10); <span class="comment">//almeno 100 us (microsecondi)</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        digitalWrite(pinReset, LOW);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        delay(50);<span class="comment">//almeno 5 ms (millisecondi)</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// ## ATTESA ATTIVAZIONE ## //</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">// RFM69HCW richiede un&#39;attesa di almeno 10 ms tra l&#39;accensione e il primo</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// messaggio. Questo delay li garantisce.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    delay(20);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// ## CONTROLLO DELLA CONNESSIONE ## //</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// Il registo 0x10 della radio contiene la versione del chip. Per la radio</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// per cui ho scritto questo programma (RFM69HCW ISM TRANSCEIVER MODULE v1.1)</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// il valore è 0x24. Se il valore è differente non è garantito che questo</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// programma funzioni.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    uint8_t versioneChip = bus-&gt;leggiRegistro(RFM69_10_VERSION);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// Se la versione risulata un byte uniforme, probabilmente nessun dispositivo</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// ha risposto sul bus SPI</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(versioneChip == 0 || versioneChip == 0xff) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda677f8df162b335244aba4cbfc3269d55">Errore::initNessunaRadioConnessa</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// Se la versione non è quella attesa segnalalo e blocca.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (versioneChip != 0x24) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdab7824a08ae4a1e280489358624924841">Errore::initVersioneRadioNon0x24</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Se poi a un&#39;analisi del programma il nuovo dispositivo risulterà compatibile</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// con quello per cui ho scritto questo programma (versione == 0x24) basterà</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// aggiungere qui sotto il nuovo numero come valore valido.</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// ## INTERRUPT ## //</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// se il pin scelto come interrupt non ha questa capacità blocca l&#39;inizializzazione</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span>(numeroInterrupt == NOT_AN_INTERRUPT) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda7deab02c3f8bc7d1f5180194ca9cfac9">Errore::initPinInterruptNonValido</a>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Ora il pin è per forza un interrupt; collegalo alla funzione ISR di questa classe</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    attachInterrupt(numeroInterrupt, isrCaller, RISING);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// pointer a disposizione dell&#39;ISR per riferire a questa classe</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    pointerRadio = <span class="keyword">this</span>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// ## IMPOSTAZIONE DELLA RADIO ## //</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span>(!caricaImpostazioni()) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda32c665bd126049272eb5710b008ece38">Errore::initErroreImpostazione</a>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// ## INIZIALIZZAZIONE DI VARIABILI ## //</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    buffer.init(lunghezzaMaxMessaggio);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    lungMaxMessEntrata = lunghezzaMaxMessaggio;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    messaggiInviati = 0;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    messaggiRicevuti = 0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    durataUltimaAttesaAck = 0;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    durataMassimaAttesaAck = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    sommaAtteseAck = 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    nrAckRicevuti = 0;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="class_r_f_m69.html#af99075e6623090f855f4af50ec8f23b1">standby</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda235c4f417511b0ac015c31486ee1369f">Errore::ok</a>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;}</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">// Inizializza la radio e stampa il risultato dell&#39;inizializzazione</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a2cc835a7a9122aacdefd035f1a0a333a">  383</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_r_f_m69.html#ad3f48e5290ae7a04fcb82c79386eff68">RFM69::inizializza</a>(uint8_t lunghezzaMaxMessaggio, HardwareSerial&amp; serial) {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    serial.print(F(<span class="stringliteral">&quot;Inizializzazione RFM69... &quot;</span>));</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordtype">int</span> errore = <a class="code" href="class_r_f_m69.html#ad3f48e5290ae7a04fcb82c79386eff68">inizializza</a>(lunghezzaMaxMessaggio);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span>(!errore) serial.println(F(<span class="stringliteral">&quot;ok&quot;</span>));</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="class_r_f_m69.html#a42670b5f67f3a0f072e1c86c3ad66fea">stampaErroreSerial</a>(serial, errore, <span class="keyword">false</span>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">return</span> errore;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">// Scrittura in tutti i registri della radio dei valori definiti nel file di</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">// impostazione</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordtype">bool</span> RFM69::caricaImpostazioni() {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// Se un pin di reset è disponibile esegui un reset della radio</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span>(haReset) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        digitalWrite(pinReset, HIGH);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        delay(10); <span class="comment">//almeno 100 us (microsecondi)</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        digitalWrite(pinReset, LOW);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        delay(50);<span class="comment">//almeno 5 ms (millisecondi)</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// Scrivi tutti i valori dell&#39;array valoreRegistri nei registri corrispondenti</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordtype">int</span> indice = 0;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordtype">int</span> registro = 0;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">while</span>(registro &lt; RFM69_ULTIMO_REGISTRO) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">if</span>(!RFM69_RESERVED(registro)) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            bus-&gt;scriviRegistro(registro, VALORE_REGISTRI(indice));</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            ++indice;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        ++registro;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    regOpMode = VALORE_REGISTRI(0x01);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">/*/ DEBUG</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">    // Stampa valore effettivo e valore atteso (cioé scritto nell&#39;array</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">    // valoreRegistri() all&#39;indice corrispondente) per ogni registro</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">    int i = 0, r = 0;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">    while(r &lt;= RFM69_ULTIMO_REGISTRO) {</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">        if(!RFM69_RESERVED(r)) {</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">            uint8_t reg = bus-&gt;leggiRegistro(r);</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">            uint8_t val = VALORE_REGISTRI(i);</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">            Serial.print(&quot;Reg 0x&quot;); Serial.print(r, HEX);</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">            Serial.print(&quot;: 0x&quot;); Serial.print(reg, HEX);</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">            Serial.print(&quot;\t&quot;);</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">            Serial.print(&quot;Atteso (ind &quot;); Serial.print(i);</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">            Serial.print(&quot;): 0x&quot;); Serial.print(val, HEX);</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">            Serial.print(&quot;\t&quot;);</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">            Serial.print(val == reg ? &quot;&quot; : &quot;#&quot;);</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">            Serial.print(&quot;\n&quot;);</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">            i++;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">        r++;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">    // fine debug */</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// Controlla un solo registro. Non è una prova certa della corretta scrittura</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">// di tutti i registri, ma poiché alcuni contengono anche byte il cui valore</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// non è impostabile (unused, r, w, r/wc) una lettura di tutti i registri scritti</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// richiederebbe molte eccezioni (es. leggi il registro 4 ignorando il bit 3)</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// Il registro PaLevel non può avere valore 0x0 (non avrebbe senso) e tutti</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// i suoi bits sono utilizzati e impostati da questo programma</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// l&#39;indice è 16 e non 17 perché c&#39;è di mezzo un registro RESERVED</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span>(bus-&gt;leggiRegistro(RFM69_11_PA_LEVEL) != VALORE_REGISTRI(16)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">// ### 6. Impostazioni modificabili in runtime ### //</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">//Imposta la potenza di trasmissione del segnale radio</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a6d669858f310c67aa49a1ae09d3d6499">  467</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_r_f_m69.html#a6d669858f310c67aa49a1ae09d3d6499">RFM69::impostaPotenzaTx</a>(<span class="keywordtype">int</span> dBm) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// Controlla che la potenza sia all&#39;interno dei limiti</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span>(dBm &lt; -18) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span>(dBm &gt; 20) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordtype">bool</span> pa0, pa1, pa2;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">int</span> outPow; <span class="comment">//solo i primi 5 bit possono essere usati.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span>(dBm &lt;= -2) {      <span class="comment">//opzione 1</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        pa0 = 1;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        pa1 = 0;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        pa2 = 0;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        outPow = dBm + 18;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        highPower = <span class="keyword">false</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dBm &lt;= 13) { <span class="comment">//opzione 2</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        pa0 = 0;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        pa1 = 1;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        pa2 = 0;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        outPow = dBm + 18;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        highPower = <span class="keyword">false</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dBm &lt;= 17) { <span class="comment">//opzione 3</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        pa0 = 0;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        pa1 = 1;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        pa2 = 1;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        outPow = dBm + 14;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        highPower = <span class="keyword">false</span>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dBm &lt;= 20) { <span class="comment">//opzione 4</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        pa0 = 0;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        pa1 = 1;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        pa2 = 1;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        outPow = dBm + 11;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        highPower = <span class="keyword">true</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">//prepara il byte che sarà scritto nel registro e invia alla radio</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    uint8_t paLevel = 0;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    paLevel = (pa0 &lt;&lt; 7) | (pa1 &lt;&lt; 6) | (pa2 &lt;&lt; 5) | outPow;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    bus-&gt;scriviRegistro(RFM69_11_PA_LEVEL, paLevel);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">// Imposta la bit rate della comunicazione radio (bit al secondo)</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a0764053e5601fbd866bc458c6b641445">  520</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_r_f_m69.html#a0764053e5601fbd866bc458c6b641445">RFM69::impostaBitRate</a>(uint32_t bitRate) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">//Controlla che non si eccedano i limiti PER FSK (!!per ook il limite</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// superiore è più basso, 32&#39;768!!)</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span>((1200 &gt; bitRate) || (300000 &lt; bitRate)) <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdafd752aea39d752659089bbe66539cfc6">Errore::errore</a>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">// La bitrate si imposta nei registri 0x03 (MSB) e 0x04 (LSB) secondo la</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// formula [valoreRegistri = Fxosc/BitRate], con [Fxosc = 32&#39;000&#39;000]</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// Lo 0.5 aggiunto alla fine serve per migliorare l&#39;approssimazione.</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    uint16_t val = (32000000.00 / (float)bitRate) + 0.5;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// Scrivi i registri</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    bus-&gt;scriviRegistro(RFM69_03_BITRATE_MSB, val &gt;&gt; 8);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    bus-&gt;scriviRegistro(RFM69_04_BITRATE_LSB, val);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span>(bitRate == (((uint16_t)bus-&gt;leggiRegistro(RFM69_03_BITRATE_MSB) &lt;&lt; 8) | bus-&gt;leggiRegistro(RFM69_04_BITRATE_LSB)))</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda235c4f417511b0ac015c31486ee1369f">Errore::ok</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdafd752aea39d752659089bbe66539cfc6">Errore::errore</a>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;}</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">// Imposta la frequency deviation per la modulazione FSK</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00546"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a0be22ccf2de531ed50b08783c4ca15c3">  546</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_r_f_m69.html#a0be22ccf2de531ed50b08783c4ca15c3">RFM69::impostaFreqDev</a>(uint32_t freqDev) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">// La Frequency Deviation per la modulazione FSK si imposta nei registri</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">// 0x05 (MSB) e 0x06 (LSB) secondo la formula</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// [valoreRegistri = Fdev/Fstep], con [Fstep = Fxosc/2^19 = 32&#39;000&#39;000/2^19]</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Lo 0.5 aggiunto alla fine serve per migliorare l&#39;approssimazione.</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    uint16_t val = (freqDev / (32000000.0 / 524288.0) ) + 0.5;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">// Scrivi i registri e assicurati che sianon stati scritti correttamente</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    bus-&gt;scriviRegistro(RFM69_05_FDEV_MSB, val &lt;&lt; 8);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    bus-&gt;scriviRegistro(RFM69_06_FDEF_LSB, val);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span>(freqDev == (((uint16_t)bus-&gt;leggiRegistro(RFM69_05_FDEV_MSB) &lt;&lt; 8) | bus-&gt;leggiRegistro(RFM69_06_FDEF_LSB)))</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda235c4f417511b0ac015c31486ee1369f">Errore::ok</a>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdafd752aea39d752659089bbe66539cfc6">Errore::errore</a>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;}</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">// Imposta la frequenza del segnale radio</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a85789df072dfcf0395797a975822788b">  569</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_r_f_m69.html#a85789df072dfcf0395797a975822788b">RFM69::impostaFrequenzaMHz</a>(uint32_t freq) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// Divide il valore come indicato alla p. 17 del datasheet del modulo RFM69HCW:</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// [Valore nei registri = FreqRadioHz / Fstep] dove [Fstep = Fxosc / 2^19]</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">// con  [Fxosc = 32MHz].</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    freq /= 32000000 / 524288;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// Scrive il valore ottenuto nei registri</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">//Registro RegFrfMsb</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    bus-&gt;scriviRegistro(RFM69_07_FRF_MSB, freq &gt;&gt; 16);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">//Registro RegFrfMid</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    bus-&gt;scriviRegistro(RFM69_08_FRF_MID, freq &gt;&gt; 8);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">//Registro RegFrfLsb</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    bus-&gt;scriviRegistro(RFM69_09_FRF_LSB, freq);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span>(freq == (((uint32_t)bus-&gt;leggiRegistro(RFM69_07_FRF_MSB) &lt;&lt; 16) | (bus-&gt;leggiRegistro(RFM69_08_FRF_MID) &lt;&lt; 8) | (bus-&gt;leggiRegistro(RFM69_09_FRF_LSB))))</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda235c4f417511b0ac015c31486ee1369f">Errore::ok</a>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdafd752aea39d752659089bbe66539cfc6">Errore::errore</a>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;}</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">// ### 7. Debug ### //</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">// Stampa il valore di tutti i registri della radio sul monitor seriale</span></div><div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a7a65d533c452153744998ba3ae33196f">  601</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_r_f_m69.html#a7a65d533c452153744998ba3ae33196f">RFM69::stampaRegistriSerial</a>(HardwareSerial&amp; serial) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">bool</span> lineaVuota = <span class="keyword">false</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// l&#39;ultimo registro è 0x71</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 0x72; i++) {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">// Non leggere i registri riservati ma stampa al posto di ogni blocco di</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="comment">// registri riservati una linea vuota</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// La macro RFM69_RESERVED è definita in &quot;Registri_RFM69.h&quot;</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">if</span>(RFM69_RESERVED(i)) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">if</span>(!lineaVuota) serial.print(<span class="stringliteral">&quot;[...]\n&quot;</span>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            lineaVuota = <span class="keyword">true</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keywordflow">else</span> lineaVuota = <span class="keyword">false</span>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">//leggi il registro e stampane indirizzo e valore</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        uint8_t val = bus-&gt;leggiRegistro(i);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        serial.print(<span class="stringliteral">&quot;0x&quot;</span>); serial.print(i,HEX);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        serial.print(<span class="stringliteral">&quot;\t\t&quot;</span>);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        serial.print(<span class="stringliteral">&quot;0x&quot;</span>); serial.print(val, HEX);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        serial.print(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;}</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a34a9de7e3b90617f3cd036a3c85fe4ee">  629</a></span>&#160;uint8_t <a class="code" href="class_r_f_m69.html#a34a9de7e3b90617f3cd036a3c85fe4ee">RFM69::valoreRegistro</a>(uint8_t indirizzo) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">return</span> bus-&gt;leggiRegistro(indirizzo);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;}</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">// ### 8. testConnessione ** //</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="class_r_f_m69.html#a865d80a26f5812b925ebc0cdfe7b3633">  637</a></span>&#160;uint8_t <a class="code" href="class_r_f_m69.html#a865d80a26f5812b925ebc0cdfe7b3633">RFM69::testConnessione</a>() {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    bus-&gt;inizializza();</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">return</span> bus-&gt;leggiRegistro(0x10);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div><div class="ttc" id="class_r_f_m69_html_a7a65d533c452153744998ba3ae33196f"><div class="ttname"><a href="class_r_f_m69.html#a7a65d533c452153744998ba3ae33196f">RFM69::stampaRegistriSerial</a></div><div class="ttdeci">void stampaRegistriSerial(HardwareSerial &amp;Serial)</div><div class="ttdoc">Stampa il valore di tutti i registri della radio sul monitor seriale. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00601">RFM69_inizializzazione.cpp:601</a></div></div>
<div class="ttc" id="class_r_f_m69_html_adfa7e0b65159b8a2e31c2b687c3f7181"><div class="ttname"><a href="class_r_f_m69.html#adfa7e0b65159b8a2e31c2b687c3f7181">RFM69::RFM69</a></div><div class="ttdeci">RFM69(Bus *interfaccia, uint8_t pinInterurpt, uint8_t pinReset=0xff)</div><div class="ttdoc">Constructor: richiede l&amp;#39;utilizzo di una delle funzioni sottostanti. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00242">RFM69_inizializzazione.cpp:242</a></div></div>
<div class="ttc" id="class_r_f_m69_html_ad3f48e5290ae7a04fcb82c79386eff68"><div class="ttname"><a href="class_r_f_m69.html#ad3f48e5290ae7a04fcb82c79386eff68">RFM69::inizializza</a></div><div class="ttdeci">int inizializza(uint8_t lunghezzaMaxMessaggio)</div><div class="ttdoc">Inizializza la radio. Deve essere chiamato all&amp;#39;inizio del programma. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00287">RFM69_inizializzazione.cpp:287</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a0764053e5601fbd866bc458c6b641445"><div class="ttname"><a href="class_r_f_m69.html#a0764053e5601fbd866bc458c6b641445">RFM69::impostaBitRate</a></div><div class="ttdeci">int impostaBitRate(uint32_t bitRate)</div><div class="ttdoc">Imposta la bit rate di trasmissione. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00520">RFM69_inizializzazione.cpp:520</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a6d669858f310c67aa49a1ae09d3d6499"><div class="ttname"><a href="class_r_f_m69.html#a6d669858f310c67aa49a1ae09d3d6499">RFM69::impostaPotenzaTx</a></div><div class="ttdeci">bool impostaPotenzaTx(int dBm)</div><div class="ttdoc">Imposta la potenza di trasmissione. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00467">RFM69_inizializzazione.cpp:467</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcda677f8df162b335244aba4cbfc3269d55"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda677f8df162b335244aba4cbfc3269d55">RFM69::Errore::initNessunaRadioConnessa</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00618">RFM69.h:618</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a82f0292b4968b3d497587341f513fb15"><div class="ttname"><a href="class_r_f_m69.html#a82f0292b4968b3d497587341f513fb15">RFM69::creaInterfacciaSpi</a></div><div class="ttdeci">static Bus * creaInterfacciaSpi(uint8_t pinSS)</div><div class="ttdoc">Helper per il constructor: usa l&amp;#39;interfaccia SPI. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00253">RFM69_inizializzazione.cpp:253</a></div></div>
<div class="ttc" id="class_r_f_m69_html"><div class="ttname"><a href="class_r_f_m69.html">RFM69</a></div><div class="ttdoc">Driver per i moduli radio RFM69. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00029">RFM69.h:29</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a0be22ccf2de531ed50b08783c4ca15c3"><div class="ttname"><a href="class_r_f_m69.html#a0be22ccf2de531ed50b08783c4ca15c3">RFM69::impostaFreqDev</a></div><div class="ttdeci">int impostaFreqDev(uint32_t freqDev)</div><div class="ttdoc">Imposta la Frequency Deviation per la modulazione FSK. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00546">RFM69_inizializzazione.cpp:546</a></div></div>
<div class="ttc" id="_r_f_m69__impostazioni_8h_html"><div class="ttname"><a href="_r_f_m69__impostazioni_8h.html">RFM69_impostazioni.h</a></div><div class="ttdoc">File di configurazione del modulo radio RFM69. </div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcdab7824a08ae4a1e280489358624924841"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdab7824a08ae4a1e280489358624924841">RFM69::Errore::initVersioneRadioNon0x24</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00622">RFM69.h:622</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcdad236e6412b9f36d8fcac011626cd78a7"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdad236e6412b9f36d8fcac011626cd78a7">RFM69::Errore::initInitSPIFallita</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00614">RFM69.h:614</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcda32c665bd126049272eb5710b008ece38"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda32c665bd126049272eb5710b008ece38">RFM69::Errore::initErroreImpostazione</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00629">RFM69.h:629</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a071ccf60c7bee588fef852027db4e734"><div class="ttname"><a href="class_r_f_m69.html#a071ccf60c7bee588fef852027db4e734">RFM69::creaInterfacciaSC18IS602B</a></div><div class="ttdeci">static Bus * creaInterfacciaSC18IS602B(uint8_t indirizzoSC18, uint8_t numeroSS)</div><div class="ttdoc">Helper per il constructor: usa l&amp;#39;interfaccia I2C tramite SC18IS602B. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00264">RFM69_inizializzazione.cpp:264</a></div></div>
<div class="ttc" id="_r_f_m69_8h_html"><div class="ttname"><a href="_r_f_m69_8h.html">RFM69.h</a></div><div class="ttdoc">Header della classe RFM69. </div></div>
<div class="ttc" id="class_r_f_m69_html_a85789df072dfcf0395797a975822788b"><div class="ttname"><a href="class_r_f_m69.html#a85789df072dfcf0395797a975822788b">RFM69::impostaFrequenzaMHz</a></div><div class="ttdeci">int impostaFrequenzaMHz(uint32_t freq)</div><div class="ttdoc">Imposta la bandwidth del channel filter. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00569">RFM69_inizializzazione.cpp:569</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a1480e160ba613aa6eacc372b87973cbd"><div class="ttname"><a href="class_r_f_m69.html#a1480e160ba613aa6eacc372b87973cbd">RFM69::~RFM69</a></div><div class="ttdeci">~RFM69()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00270">RFM69_inizializzazione.cpp:270</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a865d80a26f5812b925ebc0cdfe7b3633"><div class="ttname"><a href="class_r_f_m69.html#a865d80a26f5812b925ebc0cdfe7b3633">RFM69::testConnessione</a></div><div class="ttdeci">uint8_t testConnessione()</div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00637">RFM69_inizializzazione.cpp:637</a></div></div>
<div class="ttc" id="class_r_f_m69_1_1_s_c18_i_s602_b_html"><div class="ttname"><a href="class_r_f_m69_1_1_s_c18_i_s602_b.html">RFM69::SC18IS602B</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l01078">RFM69.h:1078</a></div></div>
<div class="ttc" id="class_r_f_m69_1_1_bus_html"><div class="ttname"><a href="class_r_f_m69_1_1_bus.html">RFM69::Bus</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l01001">RFM69.h:1001</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a42670b5f67f3a0f072e1c86c3ad66fea"><div class="ttname"><a href="class_r_f_m69.html#a42670b5f67f3a0f072e1c86c3ad66fea">RFM69::stampaErroreSerial</a></div><div class="ttdeci">void stampaErroreSerial(HardwareSerial &amp;serial, int errore, bool contesto=true)</div><div class="ttdoc">Stampa la descrizione di un errore sul monitor seriale. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__funzioni__secondarie_8cpp_source.html#l00231">RFM69_funzioni_secondarie.cpp:231</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcda235c4f417511b0ac015c31486ee1369f"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda235c4f417511b0ac015c31486ee1369f">RFM69::Errore::ok</a></div><div class="ttdoc">Nessun errore. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00604">RFM69.h:604</a></div></div>
<div class="ttc" id="class_r_f_m69_1_1_spi_html"><div class="ttname"><a href="class_r_f_m69_1_1_spi.html">RFM69::Spi</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l01031">RFM69.h:1031</a></div></div>
<div class="ttc" id="_r_f_m69__registri_8h_html"><div class="ttname"><a href="_r_f_m69__registri_8h.html">RFM69_registri.h</a></div><div class="ttdoc">Registri della radio RFM69. </div></div>
<div class="ttc" id="class_r_f_m69_html_af99075e6623090f855f4af50ec8f23b1"><div class="ttname"><a href="class_r_f_m69.html#af99075e6623090f855f4af50ec8f23b1">RFM69::standby</a></div><div class="ttdeci">void standby(bool aspetta=false)</div><div class="ttdoc">Mette la radio in standby (richiederà 1.25mA di corrente) </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__funzioni__secondarie_8cpp_source.html#l00169">RFM69_funzioni_secondarie.cpp:169</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcda7deab02c3f8bc7d1f5180194ca9cfac9"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcda7deab02c3f8bc7d1f5180194ca9cfac9">RFM69::Errore::initPinInterruptNonValido</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00626">RFM69.h:626</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcdab9cfc9dd42ee81347cf9fd0e4aa6954a"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdab9cfc9dd42ee81347cf9fd0e4aa6954a">RFM69::Errore::initTroppeRadio</a></div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00611">RFM69.h:611</a></div></div>
<div class="ttc" id="class_r_f_m69_html_a34a9de7e3b90617f3cd036a3c85fe4ee"><div class="ttname"><a href="class_r_f_m69.html#a34a9de7e3b90617f3cd036a3c85fe4ee">RFM69::valoreRegistro</a></div><div class="ttdeci">uint8_t valoreRegistro(uint8_t indirizzo)</div><div class="ttdoc">Leggi il valore di un registro della radio. </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69__inizializzazione_8cpp_source.html#l00629">RFM69_inizializzazione.cpp:629</a></div></div>
<div class="ttc" id="struct_r_f_m69_1_1_errore_html_a4dadb6af0e4d38eaac18d3afe26e5bcdafd752aea39d752659089bbe66539cfc6"><div class="ttname"><a href="struct_r_f_m69_1_1_errore.html#a4dadb6af0e4d38eaac18d3afe26e5bcdafd752aea39d752659089bbe66539cfc6">RFM69::Errore::errore</a></div><div class="ttdoc">Errore generico </div><div class="ttdef"><b>Definition:</b> <a href="_r_f_m69_8h_source.html#l00606">RFM69.h:606</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generato da &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
